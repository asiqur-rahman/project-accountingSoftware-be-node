CREATE OR REPLACE  PROCEDURE `Dashboard`(
	days INT
)
BEGIN
	DECLARE totalSale INT DEFAULT 0;
	DECLARE preTotalSale INT DEFAULT 0;
	DECLARE totalExpense INT DEFAULT 0;
	DECLARE preTotalExpense INT DEFAULT 0;
	DECLARE totalSupply INT DEFAULT 0;
	DECLARE preTotalSupply INT DEFAULT 0;
	-- DROP PROCEDURE IF EXISTS `Dashboard`;
	
	select IFNULL(sum(s.cash+s.card+s.card2+s.cheque),0) INTO totalSale from sales s where s.`date`=CURDATE();
	
	select IFNULL(sum(s.cash+s.card+s.card2+s.cheque),0) INTO preTotalSale from sales s where s.`date`= DATE_SUB(CURDATE(), INTERVAL 1 DAY);
	
	select IFNULL(SUM(e.shopRent+e.accountantFee+e.bankFee+e.gst+e.electricityBill+e.mobileBill+e.truckBill+e.insuranceFee+e.`others`),0) into totalExpense from expenses e where e.`date`=CURDATE();

	select IFNULL(SUM(e.shopRent+e.accountantFee+e.bankFee+e.gst+e.electricityBill+e.mobileBill+e.truckBill+e.insuranceFee+e.`others`),0) into preTotalExpense from expenses e where e.`date`= DATE_SUB(CURDATE(), INTERVAL 1 DAY);

	select IFNULL(SUM(s.amount),0) into totalSupply from supplies s where s.`date`=CURDATE();
   	
	select IFNULL(SUM(s.amount),0) into preTotalSupply from supplies s where s.`date`= DATE_SUB(CURDATE(), INTERVAL 1 DAY);

	IF days > 0 THEN
        select 
        	totalSale AS Total_Sales,
			preTotalSale AS Today_Sales_Pre,
			totalExpense AS Today_Expense,
			preTotalExpense AS Today_Expense_Pre,
			totalSupply AS Today_Supplies,
			preTotalSupply AS Today_Supplies_Pre,
			GROUP_CONCAT(DATE_FORMAT(s.`date`, "%d/%m/%Y") ORDER BY s.`date` ASC  SEPARATOR ',') as dates,
			GROUP_CONCAT(TRUNCATE(IFNULL(s.cash+s.card+s.card2+s.cheque ,0),2) ORDER BY s.`date` ASC SEPARATOR ',') as sales
		from sales s where (s.`date` BETWEEN  DATE_SUB(CURDATE(), INTERVAL days DAY) AND CURDATE()) order by DATE(s.`date`) desc;
   	ELSE
        select 
        	totalSale AS Total_Sales,
			preTotalSale AS Today_Sales_Pre,
			totalExpense AS Today_Expense,
			preTotalExpense AS Today_Expense_Pre,
			totalSupply AS Today_Supplies,
			preTotalSupply AS Today_Supplies_Pre,
			GROUP_CONCAT(DATE_FORMAT(s.`date`, "%d/%m/%Y") ORDER BY s.`date` ASC  SEPARATOR ',') as dates,
			GROUP_CONCAT(TRUNCATE(IFNULL(s.cash+s.card+s.card2+s.cheque ,0),2) ORDER BY s.`date` ASC SEPARATOR ',') as sales
		from sales s where (s.`date` BETWEEN  DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND CURDATE()) order by DATE(s.`date`) desc;
    END IF;
END